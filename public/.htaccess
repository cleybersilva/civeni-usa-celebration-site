# Configurações para o Apache - Templates e Arquivos Office
RewriteEngine On

# Configurações MIME para arquivos Office
AddType application/vnd.ms-word .doc
AddType application/vnd.openxmlformats-officedocument.wordprocessingml.document .docx
AddType application/vnd.ms-powerpoint .ppt
AddType application/vnd.openxmlformats-officedocument.presentationml.presentation .pptx
AddType application/vnd.ms-excel .xls
AddType application/vnd.openxmlformats-officedocument.spreadsheetml.sheet .xlsx

# Headers para download de arquivos Office
<FilesMatch "\.(doc|docx|ppt|pptx|xls|xlsx)$">
    Header set Content-Disposition "attachment"
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
    # Permitir CORS para templates
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header set Access-Control-Allow-Headers "Content-Type"
</FilesMatch>

# Configurações de encoding para caracteres especiais
AddDefaultCharset UTF-8

# Configuração para SPA - React Router
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/templates/
RewriteRule . /index.html [L]

# Configurações de cache otimizadas
<IfModule mod_expires.c>
    ExpiresActive on
    
    # Templates e documentos - sem cache para garantir versões atualizadas
    ExpiresByType application/vnd.ms-word "access plus 0 seconds"
    ExpiresByType application/vnd.openxmlformats-officedocument.wordprocessingml.document "access plus 0 seconds"
    ExpiresByType application/vnd.ms-powerpoint "access plus 0 seconds"
    ExpiresByType application/vnd.openxmlformats-officedocument.presentationml.presentation "access plus 0 seconds"
    
    # Outros arquivos estáticos
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
</IfModule>

# Configurações de compressão (exceto arquivos Office já comprimidos)
<IfModule mod_deflate.c>
    SetOutputFilter DEFLATE
    SetEnvIfNoCase Request_URI \
        \.(?:gif|jpe?g|png|doc|docx|ppt|pptx|xls|xlsx)$ no-gzip dont-vary
    SetEnvIfNoCase Request_URI \
        \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
</IfModule>

# Headers de segurança
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Frame-Options SAMEORIGIN
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    
    # CSP ajustado para incluir viewers Office online
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://fonts.googleapis.com https://wdkeqxfglmritghmakma.supabase.co; frame-src 'self' https://view.officeapps.live.com https://docs.google.com; connect-src 'self' https://wdkeqxfglmritghmakma.supabase.co"
</IfModule>